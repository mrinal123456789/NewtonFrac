<html>
    <head>
        
    </head>
    <body style="background-color:#97bfbb">
        <canvas id="canv" width="720px" height="540px" style="background-color:#ffffff;width:720px;height:540px;margin-top:30px;position:fixed;">fml</canvas>
        <div width="200px" height = "540px" style="margin-top:30px;left:750px;position:fixed;"><button onclick="resetScreen()">Reset</button></div>
		<script>
            var canv = document.getElementById("canv");
            var c = canv.getContext("2d");
            
            
            var c_w = 720;
            var c_h = 540;
            var max_res = 8 + 6;
            
            var w_x = 0.0;//Center X
            var w_y = 0.0;//Center Y
            var w_w = 2.0;//Half the width
            var w_h = 1.5;//Half the height
            var w_orig = w_w;
            var h_orig = w_h;
        
            
            var mode = 0;
            var clickX = 0;
            var clickY = 0;
            /*function mouseClick(e)
            {
                console.log(e.clientX + ", " + e.clientY)
                if (mode == 0)
                {
                    mode++;
                    clickX = e.clientX - 10;
                    clickY = e.clientY - 40;
                }
            }
        
            function mouseMove(e)
            {
                if (mode == 1)
                {
                    cOverlay.clearRect(0,0,c_w,c_h);
                    cOverlay.strokeRect(clickX * 2, clickY * 2, 2 * (e.clientX - 10 - clickX), 2 * (e.clientY - 40 - clickY));
                }
            }
        
            function mouseRelease(e)
            {
                if (mode == 1)
                {
                    cOverlay.clearRect(0,0,c_w,c_h)
                    mode = 0;
                    var px_w = 2 * (e.clientX - 10 - clickX);
                    var px_h = 2 * (e.clientY - 40 - clickY);
                    var px_x = 2 * clickX + px_w  / 2;
                    var px_y = 2 * clickY + px_h / 2;
                    w_x = w_x + (px_x - c_w / 2) / c_w * w_w;
                    w_y = w_y + (px_y - c_h / 2) / c_h * w_h;
                    w_w = Math.abs(px_w) / c_w * w_w;
                    w_h = Math.abs(px_h) / c_h * w_h;
                    //console.log(w_x + ", " + w_y + ", " + w_w + ", " + w_h)
                    max_res = 10 * Math.pow(Math.max(2.0 / w_orig, 1.5 / h_orig), 2)
                    refreshScreen();
                }
                
            }
        
            overlay.onmousedown = mouseClick;
            overlay.onmousemove = mouseMove;
            overlay.onmouseup = mouseRelease;*/
            canv.onclick = function (e)
            {
				if (mode == 0)
				{
					var scale = 1 / 2;
					var clickX = e.clientX - 10;
					var clickY = e.clientY - 40;
					w_x = w_x - w_w + clickX / c_w * 2 * w_w;
					w_y = w_y - w_h + clickY / c_h * 2 * w_h;
					w_w *= scale;
					w_h *= scale;
					
					max_res = Math.floor(8 * Math.pow(Math.max(w_orig / w_w, h_orig / w_h), 0.4)) + 6
					refreshScreen();
				}
            }
        
            function resetScreen()
            {
                w_w = w_orig;
                w_h = h_orig;
                w_x = 0;
                w_y = 0;
                max_res = Math.floor(8 * Math.pow(Math.max(w_orig / w_w, h_orig / w_h), 0.4)) + 6
                refreshScreen();
            }
        
            function refreshScreen()
            {
                w = new Worker("GenFractal.js")
				var id = Math.floor(Math.random() * 0x10000)
                mode = -1;
				var imgData = (c.getImageData(0,0,c_w, c_h));
				w.onmessage = function(d)
				{
					if (d.data.id == id)
					{
						//alert("done");
						c.putImageData(d.data.data, 0, 0);
						mode = 0;
					}
					else
					{
						c.putImageData(d.data.data, 0, 0);
					}
				}
				w.postMessage({id: id, data: [c_w, c_h, w_x, w_y, w_w, w_h, max_res, imgData]});

            }
        
        refreshScreen();
        </script>
    </body>
</html>
