<html>
    <head>
        
    </head>
    <body style="background-color:#97bfbb">
        <canvas id="canv" width="720px" height="540px" style="background-color:#ffffff;width:720px;height:540px;margin-top:30.0px;position:fixed;">fml</canvas>
        <div width="200px" height = "540px" style="margin-top:30.0px;left:750px;position:fixed;"><button onclick="resetScreen()">Reset</button></div>
		<script>
            var canv = document.getElementById("canv");
            var c = canv.getContext("2d");
            
            
            var c_w = 720;
            var c_h = 540;
            var max_res = 30.0;
            
            var w_x = 0.001;//Center X
            var w_y = 0.0;//Center Y
            var w_w = 2.0 * 0.8;//Half the width
            var w_h = 1.5 * 0.8;//Half the height
            var w_orig = w_w;
            var h_orig = w_h;
        
            
			var superMode = 0;
            var mode = 0;
            var clickX = 0;
            var clickY = 0;
            
            canv.onclick = function (e)
            {
				if (superMode == 0)
				{
					if (mode == 0)
					{
						var scale = 1 / 2;
						var clickX = e.clientX - 10;
						var clickY = e.clientY - 40;
						w_x = w_x - w_w + clickX / c_w * 2 * w_w;
						w_y = w_y - w_h + clickY / c_h * 2 * w_h;
						w_w *= scale;
						w_h *= scale;
						
						max_res = (-1) * Math.log(w_w) * 4 + 30.0;
						refreshScreen();
					}
				}
				else if (superMode == 1)
				{
					
				}
            }
        
            function resetScreen()
            {
                w_w = w_orig;
                w_h = h_orig;
                w_x = 0;
                w_y = 0;
                max_res = 30.0;
                refreshScreen();
            }
        
            function refreshScreen()
            {
               	w = new Worker("GenFractal.js")
				w2 = new Worker("GenFractal.js")
				var id = 10;
				var id2 = 20;
           		   	mode = -1;
				var imgData = (c.getImageData(0,0,c_w / 2, c_h));
				var imgData2 = (c.getImageData(c_w / 2, -1, c_w / 2, c_h + 1));
				w.onmessage = function(d)
				{
					if (d.data.id == id)
					{
						//alert("done");
						c.putImageData(d.data.data, 0, 0);
						mode = 0;
					}
					else
					{
						c.putImageData(d.data.data, 0, 0);
					}
				}
				w2.onmessage = function(d)
				{
					if (d.data.id == id2)
					{
						//alert("done");
						c.putImageData(d.data.data, c_w / 2, -1);
						mode = 0;
					}
					else
					{
						c.putImageData(d.data.data, c_w / 2, -1);
					}
				}
				
				w.postMessage({id: id, data: [c_w, c_h, w_x, w_y, w_w, w_h, max_res, imgData]});
				w2.postMessage({id: id2, data: [c_w, c_h, w_x, w_y, w_w, w_h, max_res, imgData2]});
            }
        
        refreshScreen();
        </script>
    </body>
</html>
